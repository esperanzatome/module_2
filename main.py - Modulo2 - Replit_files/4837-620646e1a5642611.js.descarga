(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4837],{34837:function(e){e.exports=e=>{const t=o("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAPAAAAAQCAYAAAAoEfIQAAAAAXNSR0IArs4c6QAAActJREFUaIHtmttuwyAMQEm1//9l9kTEHGyMb4HVR6rSJYAdX8CDlpIkSZIkSbITFXxO5WTdT8fd9pe3AANqidWzGR3KxO7DNhpde4dj8mc6aPtYEO0zS0ZJJ3mXENvvbuQVI6zOdqPxOIE3a6MJXgv5fTvI7v5+m2ZbGHerPtXYHpM1vP+zoMCqEpr+UrT6WemwwwrU5EfqwrGrNpAlaMda9anG9iNZ6DhYAltAlYAcYHvvQOSOz3GmNIm58iksKgTpBGxVJXlMsJIEhPciJsMKrv39h+yPszLfDCzFItAmSNuwowKYI0Pz3hV8l2wkYv0i/DHSlfsO2D7LBZ7feK7AGqgAe7s0XSGynKYCdWRPdpnWEVGW9xPfqIqTVCCcDUgLqMlv1obrvz/9d03g/0RUEmOBP0pU2Ibq3xOVCB7VS9QmlKbP7L0fzz0TWOMA7EU8A4ebaFYbE9KxqTbcwKf6Nxkrcrms9Lf09UlVWynzFfoGS+BIR1FjvHWO6UHkSqx5zm0zYzaReJ1lnxo3V3etyPf++vzjcCzOgftxvP6PopLY8occeQ4sY1bCavpzx2CTDsWBjjjRVrutRKdtQibJ60QfZSVJkiQcfgHLRY8eT2qnRAAAAABJRU5ErkJggg=="),a=o("data:image/png;base64,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"),r={};a.onload=()=>{const e=a.width/8;" !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~".split("").forEach(((t,a)=>{r[t]=[~~(a%e),~~(a/e)]}))};const s={pen:{cursor:"crosshair",key:"q",icon:0},erasor:{cursor:"crosshair",key:"w",icon:1},bucket:{cursor:"crosshair",key:"e",icon:2},rect:{cursor:"crosshair",key:"a",icon:3},circle:{cursor:"crosshair",key:"s",icon:4},line:{cursor:"crosshair",key:"d",icon:5},select:{cursor:"cell",key:"z",icon:6},move:{cursor:"move",key:"x",icon:7},eyedropper:{cursor:"crosshair",key:"c",icon:8}};function o(e,t){const a=new window.Image;return a.src=e,t&&(a.onload=()=>{t(a)}),a}function n(e,t,a){return Math.max(Math.min(e,a),t)}function i(e){return function(e){const t=new Image;return t.src=e,new Promise(((e,a)=>{t.onload=()=>{e(t)},t.onerror=()=>{a()}}))}(e).then((e=>c(e)))}const c=(e,t)=>{const a=document.createElement("canvas");let r=(()=>{if(e instanceof window.ImageData)return new window.ImageData(new Uint8ClampedArray(e.data),e.width,e.height);if(e instanceof window.Image){a.width=e.width,a.height=e.height;const t=a.getContext("2d");return t.drawImage(e,0,0),t.getImageData(0,0,e.width,e.height)}return new window.ImageData(new Uint8ClampedArray(e*t*4).fill(0),e,t)})();function s(){a.width=r.width,a.height=r.height;a.getContext("2d").putImageData(r,0,0)}function o(e,t){return 4*(t*r.width+e)}return{blend:"alpha",scissorRect:null,width:()=>r.width,height:()=>r.height,toImageData:()=>new window.ImageData(new Uint8ClampedArray(r.data),r.width,r.height),clone(){return c(this.toImageData())},clear(){r=new window.ImageData(new Uint8ClampedArray(r.width*r.height*4).fill(0),r.width,r.height)},set(e,t,a){if(!this.checkPt(e,t))return!1;const s=o(e,t);switch(this.blend){case"alpha":{const e=a[3]/255;r.data[s+0]=r.data[s+0]*(1-e)+a[0]*e,r.data[s+1]=r.data[s+1]*(1-e)+a[1]*e,r.data[s+2]=r.data[s+2]*(1-e)+a[2]*e,r.data[s+3]=r.data[s+3]*(1-e)+a[3]*e;break}case"replace":r.data[s+0]=a[0],r.data[s+1]=a[1],r.data[s+2]=a[2],r.data[s+3]=a[3];break;case"add":{const e=r.data[s+3]/255,t=a[3]/255;r.data[s+0]=r.data[s+0]*e+a[0]*t,r.data[s+1]=r.data[s+1]*e+a[1]*t,r.data[s+2]=r.data[s+2]*e+a[2]*t,r.data[s+3]=r.data[s+3]*e+a[3]*t;break}}return!0},get(e,t){const a=o(e,t);return[r.data[a+0],r.data[a+1],r.data[a+2],r.data[a+3]]},line(e,t,a,r,s){const o=a-e,n=r-t,i=Math.abs(o),c=Math.abs(n);let l=0;const h=o>0?1:-1,f=n>0?1:-1;if(i>c)for(let d=e,m=t;h<0?d>=a:d<=a;d+=h)this.set(d,m,s),l+=c,l<<1>=i&&(m+=f,l-=i);else for(let d=e,m=t;f<0?m>=r:m<=r;m+=f)this.set(d,m,s),l+=i,l<<1>=c&&(d+=h,l-=c)},fillRect(e,t,a,r,s){a<0&&(e+=a,a=-a),r<0&&(t+=r,r=-r);for(let o=e;o<e+a;o++)for(let e=t;e<t+r;e++)this.set(o,e,s)},strokeRect(e,t,a,r,s){a<0&&(e+=a,a=-a),r<0&&(t+=r,r=-r),this.line(e,t,e+a,t,s),this.line(e+a,t,e+a,t+r,s),this.line(e+a,t+r,e,t+r,s),this.line(e,t+r,e,t,s)},fillCircle(e,t,a,r){for(let s=e-(a=Math.abs(a));s<=e+a;s++)for(let o=t-a;o<=t+a;o++){Math.sqrt((s-e)**2+(o-t)**2)<=a&&this.set(s,o,r)}},bucket(e,t,a){if(!this.checkPt(e,t))return!1;const r=this.get(e,t);if(l(r,a))return!1;const s=[];for(s.push([e,t]);s.length;){const[e,t]=s.pop();this.checkPt(e,t)&&(l(this.get(e,t),r)&&(this.set(e,t,a),s.push([e,t-1]),s.push([e-1,t]),s.push([e+1,t]),s.push([e,t+1])))}return!0},merge(e,t=0,a=0){for(let s=0;s<r.width;s++)for(let o=0;o<r.height;o++){const n=e.get(s,o);n&&s+t>=0&&s+t<r.width&&o+a>=0&&o+a<r.height&&this.set(s+t,o+a,n)}},checkPt(e,t){if(this.scissorRect){const a=this.scissorRect;return e>=a[0][0]&&e<a[1][0]&&t>=a[0][1]&&t<a[1][1]}return e>=0&&e<r.width&&t>=0&&t<r.height},clampPt:e=>[n(e[0],0,r.width),n(e[1],0,r.height)],bbox(){let e=[0,0],t=[r.width-1,r.height-1];e:for(let a=e[0];a<=t[0];a++)for(let s=e[1];s<=t[1];s++){const t=o(a,s);if(0!==r.data[t+3]){e[0]=a;break e}}e:for(let a=t[0];a>=e[0];a--)for(let s=e[1];s<=t[1];s++){const e=o(a,s);if(0!==r.data[e+3]){t[0]=a;break e}}e:for(let a=e[1];a<=t[1];a++)for(let s=e[0];s<=t[0];s++){const t=o(s,a);if(0!==r.data[t+3]){e[1]=a;break e}}e:for(let a=t[1];a>=e[1];a--)for(let s=e[0];s<=t[0];s++){const e=o(s,a);if(0!==r.data[e+3]){t[1]=a;break e}}return[e,t]},crop(e,t){const a=t[0]-e[0]+1,s=t[1]-e[1]+1,o=c(a,s);for(let r=e[0];r<=t[0];r++)for(let a=e[1];a<=t[1];a++)o.set(r-e[0],a-e[1],this.get(r,a));r=o.toImageData()},toDataURL:()=>(s(),a.toDataURL("image/png")),toPNG(){const e=this.toDataURL().replace(/^data:image\/png;base64,/,""),t=window.atob(e),a=new Uint8Array(t.length);for(let r=0;r<a.length;r++)a[r]=t.charCodeAt(r);return a.buffer},drawable:()=>(s(),a),game(){const e=this.toImageData();for(let t=0;t<r.height;t++)for(let a=0;a<r.width;a++){let s=0,o=0,n=0,i=0;for(let e=-1;e<=1;e++)for(let c=-1;c<=1;c++)if((0!==e||0!==c)&&a-e>=0&&a+e<r.width&&t-c>=0&&t+c<r.height){const l=4*((t+c)*r.width+a+e);r.data[l+3]>0&&(o+=r.data[l+0],n+=r.data[l+1],i+=r.data[l+2],s++)}const c=4*(t*r.width+a);s<2||s>3?(e.data[c+0]=0,e.data[c+1]=0,e.data[c+2]=0,e.data[c+3]=0):3===s&&(e.data[c+0]=o/s,e.data[c+1]=n/s,e.data[c+2]=i/s,e.data[c+3]=255)}return c(e)}}};function l(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]}function h(e){return`rgba(${e[0]}, ${e[1]}, ${e[2]}, ${e[3]})`}function f(e){const t=parseInt(e,16);return[t>>16&255,t>>8&255,255&t,255]}const d=e.canvas,m=e.canvas.getContext("2d"),u={width:e.width,height:e.height,curFrame:0,frames:[c(e.width||64,e.height||64)],fCanvas:c(64|e.width,e.height||64),anims:{},tool:"pen",color:[0,0,0,255],palette:e.palette||[[0,0,0,255],[255,255,255,255],[255,255,128,255],[255,128,255,255],[0,128,128,255],[128,0,255,255],[255,0,128,255],[0,255,255,255]],view:{offset:[0,0],scale:1},state:{stack:[],offset:0},modified:!1,readOnly:e.readOnly,events:{},curAnim:null,animTimer:0,animSpeed:200,gaming:!1,gameTimer:0,gameSpeed:100},g={mouseDown:!1,mousePressed:!1,mouseMoved:!1,mousePos:[0,0],mousePosPrev:[0,0],mouseStartPos:null,grabbin:!1,delCb:()=>{},hideUI:!1,loopID:null,time:0};P(),m.imageSmoothingEnabled=!1;const w={game:{icon:14,action:function(){u.gaming=!0,u.readOnly=!0,I()}},export:{icon:13,action:()=>U("export")},save:{icon:12,action:()=>U("save")},crop:{icon:9,action:function(){let e,t;u.frames.forEach((a=>{const[r,s]=a.bbox();e&&t?(e[0]=Math.min(e[0],r[0]),e[1]=Math.min(e[1],r[0]),t[0]=Math.max(t[0],s[0]),t[1]=Math.max(t[1],s[0])):(e=r,t=s)})),u.frames.forEach((a=>a.crop(e,t))),u.width=j().width(),u.height=j().height(),I()}},undo:{icon:10,key:"shift+z",action:x},redo:{icon:11,key:"meta+shift+z",action:C}},p=document.createElement("input");function v(e){return[~~((e[0]-u.view.offset[0])/u.view.scale),~~((e[1]-u.view.offset[1])/u.view.scale)]}function b(){u.view.scale<=2||(u.view.scale--,u.view.offset[0]+=u.width/2,u.view.offset[1]+=u.height/2)}function k(){u.view.scale>=64||(u.view.scale++,u.view.offset[0]-=u.width/2,u.view.offset[1]-=u.height/2)}function P(){const e=d.width,t=d.height,a=(e-120)/u.width,r=(t-120)/u.height;u.view.scale=~~Math.min(a,r),u.view.offset=[(e-u.width*u.view.scale)/2,(t-u.height*u.view.scale)/2]}function y(e=u.curFrame){u.frames.splice(u.curFrame,0,j().clone()),e===u.curFrame&&D(u.curFrame+1),I()}function A(e=u.curFrame){u.frames.length>1&&(u.frames.splice(e,1),u.curFrame===u.frames.length&&D(u.frames.length-1)),I()}function D(e){u.curFrame=e,g.delCb=()=>{confirm(`removed frame ${e}?`)&&A(e)}}function R(e){"number"===typeof e?(u.color=u.palette[e],g.delCb=()=>{confirm("remove selected color?")&&(u.palette.splice(e,1),U("change",u.palette))}):u.color=e}function E(){D(0===u.curFrame?u.frames.length-1:u.curFrame-1)}function z(){D((u.curFrame+1)%u.frames.length)}function F(){const e=j(),[t,a]=e.scissorRect;e.blend="replace",e.fillRect(t[0],t[1],a[0]-t[0],a[1]-t[1],[0,0,0,0]),e.blend="alpha",I()}function U(e,...t){if(u.events[e])for(const a of u.events[e])a(...t)}function I(){u.state.stack.length>=64||(u.state.offset>0&&(u.state.stack.splice(u.state.stack.length-u.state.offset,u.state.offset),u.state.offset=0),u.state.stack.push({frames:S(),curFrame:u.curFrame}),U("change"))}function O(e){u.frames=e.frames.map(c),D(e.curFrame),U("change")}function x(){u.state.offset>=u.state.stack.length-1||(u.state.offset++,O(u.state.stack[u.state.stack.length-u.state.offset-1]))}function C(){0!==u.state.offset&&(u.state.offset--,O(u.state.stack[u.state.stack.length-u.state.offset-1]))}function S(){return u.frames.map((e=>e.toImageData()))}function K(){u.curAnim=null,u.animTimer=0,u.readOnly=e.readOnly}function Y(e){u.curAnim?K():function(e){u.curAnim=e,u.animTimer=0,D(u.anims[e].from),u.readOnly=!0}(e)}p.type="color",p.addEventListener("change",(e=>{const t=f(e.target.value.substring(1));u.palette.push(t),R(t),U("change",u.palette)})),g.loopID=window.requestAnimationFrame((function e(o){const n=o-g.time;if(g.time=o,u.gaming&&(u.gameTimer+=n,u.gameTimer>=u.gameSpeed&&(u.frames[u.curFrame]=j().game(),u.gameTimer=0)),u.curAnim&&(u.animTimer+=n,u.animTimer>=u.animSpeed)){const e=u.anims[u.curAnim];e.to<e.from?u.curFrame>e.to?E():D(e.from):u.curFrame<e.to?z():D(e.from),u.animTimer=0}let i=!1,c=!1,b=null;const k=j(),P=d.width,A=d.height,I=u.view.scale,O=u.view.offset[0],x=u.view.offset[1];function C(e,t,a={}){const r=a.lineWidth||2;let s;return{width:e,height:t,update(){s&&(a.click||a.hover)&&function(e,t,a,r){a<0&&(e+=a,a=-a),r<0&&(t+=r,r=-r);const[s,o]=g.mousePos;return s>=e&&s<=e+a&&o>=t&&o<=t+r}(s.x,s.y,e,t)&&(i=!0,a.hover&&a.hover(),g.mousePressed&&!c&&(a.click&&a.click(),c=!0))},draw(){s=m.getTransform().transformPoint(),this.update(),a.bg&&(m.fillStyle=h(a.bg),m.fillRect(0,0,e,t)),a.border&&(m.lineWidth=r,m.strokeStyle=h(a.border),m.strokeRect(0,0,e,t))}}}function S(e,t={}){const a=t.align||"left",r=t.margin||0,s=t.padding||0;let o=0,n=0;for(const h of e)h&&(o=Math.max(h.width,o),n+=h.height+r);const i=o+2*s,c=n+2*s,l=C(i,c,t);return{width:i,height:c,update(){e.reverse().forEach((e=>{e.update()}))},draw(){l.draw(),m.save(),m.translate(s,s),e.forEach((e=>{if(!e)return;const t=(()=>{switch(a){case"left":return 0;case"center":return(o-e.width)/2;case"left":return o-e.width}})();m.translate(t,0),e.draw(),m.translate(-t,e.height+r)})),m.restore()}}}function K(e,t={}){const a=t.align||"top",r=t.margin||0,s=t.padding||0;let o=0,n=0;for(const h of e)h&&(o+=h.width,n=Math.max(h.height,n));const i=o+2*s,c=n+2*s,l=C(i,c,t);return{width:i,height:c,update(){e.reverse().forEach((e=>{e.update()}))},draw(){l.draw(),m.save(),m.translate(s,s),e.forEach((e=>{if(!e)return;const t=(()=>{switch(a){case"top":return 0;case"center":return(n-2*s-e.height)/2;case"bottom":return n-2*s-e.height}})();m.translate(0,t),e.draw(),m.translate(e.width+r,-t)})),m.restore()}}}function M(e,t={}){const a=t.padding||0,r=t.sw||e.width,s=t.sh||e.height,o=(t.width||r)+2*a,n=(t.height||s)+2*a,i=o+2*a,c=n+2*a,l=t.sx||0,h=t.sy||0,f=(t.lineWidth,C(i,c,t));return{width:i,height:c,update(){f.update()},draw(){f.draw(),m.drawImage(e,l,h,r,s,a,a,o,n)}}}function J(e,t={}){e+="";const s=t.size||12,o=t.padding||0,n=e.length*s+2*o,i=s+2*o,c=t.color||[0,0,0,255],l=(t.lineWidth,C(n,i,t));return{width:n,height:i,update(){l.update()},draw(){l.draw(),m.fillStyle=h(c);const t=e.split("");let n=0;for(const e of t)if(r[e]){const[t,i]=r[e];m.drawImage(a,8*t,8*i,8,8,o+n,o,s,s),n+=s}}}}function q(e,t,a){t||a?function(e,t,a,r={}){return{width:a.width,height:a.height,update(){a.update()},draw(){m.save(),m.translate(e,t),a.draw(),m.restore()}}}(t,a,e).draw():e.draw()}function L(e,t,a,r={}){const s=C(e,t,r);return{width:e,height:t,update(){a.reverse().forEach((([e])=>{e.update()}))},draw(){s.draw(),a.forEach((([e,[t,a]])=>{m.save(),m.translate(t,a),e.draw(),m.restore()}))}}}const T=C(P,A,{bg:[170,170,170,255]}),V=K([...u.frames.map(((e,t)=>{const a=t===u.curFrame;return J(t,{padding:a?6:3,bg:a?[255,255,255,255]:[230,230,230,255],border:[0,0,0,255],size:16,click(){D(t)}})})),!u.readOnly&&J("+",{padding:3,bg:[230,230,230,255],border:[0,0,0,255],size:16,click(){y()}})],{align:"bottom"}),G=C(k.width()*I,k.height()*I,{bg:[255,255,255,255]}),N=C(k.width()*I,k.height()*I,{border:[0,0,0,255]});function H(e,t={}){const a=t.dx||0,r=t.dy||0;return{width:e.width()*I,height:e.height()*I,draw(){m.save(),m.scale(I,I),m.translate(a,r),m.drawImage(e.drawable(),0,0),m.restore()}}}if(L(P,A,[[T,[0,0]],[G,[O,x]],[H(k),[O,x]],[(()=>{if("move"===u.tool&&g.mouseStartPos){const[e,t]=v(g.mousePos),[a,r]=v(g.mouseStartPos),[s,o]=[e-a,t-r];return H(u.fCanvas,{dx:s,dy:o})}return H(u.fCanvas)})(),[O,x]],[V,[O,x-V.height]],[N,[O,x]]]).draw(),k.scissorRect){const e=k.scissorRect[0],t=k.scissorRect[1];m.lineDashOffset=o/100,m.strokeStyle=h([0,0,0,255]),m.setLineDash([5,5]),m.strokeRect(e[0]*I+O,e[1]*I+x,(t[0]-e[0])*I,(t[1]-e[1])*I),m.strokeStyle=h([255,255,255,255]),m.setLineDash([0,5,5,0]),m.strokeRect(e[0]*I+O,e[1]*I+x,(t[0]-e[0])*I,(t[1]-e[1])*I),m.setLineDash([])}if(!u.readOnly){const[e,t]=v(g.mousePos),a=e*I+O,r=t*I+x;if(k.checkPt(e,t))switch(u.tool){case"pen":case"rect":case"line":case"circle":case"bucket":q(C(I,I,{bg:u.color}),a,r);break;case"erasor":q(C(I,I,{bg:[255,255,255,255],border:[0,0,0,255]}),a,r)}}const W={padding:3,size:16,bg:[255,255,255,255],border:[0,0,0,255]},Q=S([...u.palette.map(((e,t)=>C(24,24,{bg:e,border:[0,0,0,255],lineWidth:l(e,u.color)?4:2,click(){R(t)}}))),J("+",{size:24,bg:[255,255,255,255],border:[0,0,0,255],click(){if(navigator.userAgent.match(/safari/i)){const e=prompt("Enter hex code for new color:");if(6===e?.length||7===e?.length){const t=f(e.startsWith("#")?e.substring(1):e);u.palette.push(t),R(u.palette.length-1),U("change",u.palette)}}else p.click()}})]),X=S([...Object.keys(s).map((e=>{const a=s[e];return M(t,{sx:16*a.icon,sw:16,sh:16,width:32,height:32,bg:[255,255,255,255],border:[0,0,0,255],lineWidth:u.tool===e?4:2,click(){u.tool=e},hover(){b={msg:`${e} (${a.key})`,pos:[-1,1]}}})}))]),B=K([...Object.keys(w).map((e=>{const a=w[e];return M(t,{sx:16*a.icon,sw:16,sh:16,width:32,height:32,bg:[255,255,255,255],border:[0,0,0,255],click(){a.action()},hover(){b={msg:`${e}`,pos:[-1,-1]}}})}))]),Z=S([!u.readOnly&&J("+",{...W,click(){const e=prompt("add anim:");e&&(u.anims[e]={from:0,to:0,loop:!0},U("change"))}}),...Object.keys(u.anims).map((e=>{const t=u.anims[e],a=e===u.curAnim;return K([J((a?">":"")+e,{...W,lineWidth:a?4:2,click(){Y(e)}}),J(t.from,{...W,lineWidth:a?4:2,click(){t.from=(t.from+1)%u.frames.length,U("change")}}),J(t.to,{...W,lineWidth:a?4:2,click(){t.to=(t.to+1)%u.frames.length,U("change")}})])}))]);if(g.hideUI||function(e,t,a,r={}){return L(e,t,a.filter((e=>e)).map((([a,r])=>[a,[r[0]*(e-a.width),r[1]*(t-a.height)]])),r)}(P,A,[!u.readOnly&&[Q,[0,0]],!u.readOnly&&[X,[1,0]],!u.readOnly&&[B,[1,1]],[Z,[0,1]]]).draw(),b){const e=6,[t,a]=g.mousePos,r=J(b.msg,{padding:3,bg:[255,255,255,255],border:[0,0,0,255]});q(r,t+(r.width*(b.pos[0]-1)/2+b.pos[0]*e),a+(r.height*(b.pos[1]-1)/2+b.pos[1]*e))}if(i?d.style.cursor="pointer":g.grabbin?d.style.cursor="grab":d.style.cursor=s[u.tool].cursor,g.mousePressed&&!c){const[e,t]=v(g.mousePos);if(g.mouseDown=!0,!u.readOnly)switch(u.tool){case"pen":k.set(e,t,u.color);break;case"erasor":k.blend="replace",k.set(e,t,[0,0,0,0]),k.blend="alpha";break;case"bucket":k.bucket(e,t,u.color);break;case"move":k.scissorRect&&(u.fCanvas.scissorRect=k.scissorRect,u.fCanvas.merge(k),u.fCanvas.scissorRect=null,F());break;case"eyedropper":u.color=k.get(e,t)}}g.mousePressed=!1,g.loopID=window.requestAnimationFrame(e)}));const M={wheel(e){e.preventDefault(),e.altKey?e.deltaY<0?k():e.deltaY>0&&b():(u.view.offset[0]-=e.deltaX,u.view.offset[1]-=e.deltaY)},mousedown(e){g.mousePressed=!0,g.mousePosPrev=[...g.mousePos],g.mousePos=[e.offsetX,e.offsetY],g.mouseStartPos=[...g.mousePos]},mousemove(e){if(u.readOnly)return;if(g.mousePosPrev=[...g.mousePos],g.mousePos=[e.offsetX,e.offsetY],g.mouseMoved=!0,g.grabbin&&(u.view.offset[0]+=e.movementX,u.view.offset[1]+=e.movementY),!g.mouseDown)return;const t=j(),[a,r]=v(g.mousePos),[s,o]=v(g.mousePosPrev);if(!g.mouseStartPos)return;const[n,i]=v(g.mouseStartPos);switch(u.tool){case"pen":t.line(s,o,a,r,u.color);break;case"erasor":t.blend="replace",t.line(s,o,a,r,[0,0,0,0]),t.blend="alpha";break;case"rect":u.fCanvas.clear(),u.fCanvas.fillRect(n,i,a-n,r-i,u.color);break;case"line":u.fCanvas.clear(),u.fCanvas.line(n,i,a,r,u.color);break;case"circle":u.fCanvas.clear(),u.fCanvas.fillCircle(n,i,Math.max(a-n,r-i),u.color);break;case"select":{const[e,s]=t.clampPt([n,i]),[o,c]=t.clampPt([a,r]);t.scissorRect=[[e,s],[o,c]];break}case"move":{const[e,n]=[a-s,r-o];t.scissorRect[0][0]+=e,t.scissorRect[1][0]+=e,t.scissorRect[0][1]+=n,t.scissorRect[1][1]+=n;break}}},mouseup(e){if(u.readOnly)return;g.mouseDown=!1,g.mousePosPrev=[g.mousePos,g.mousePos],g.mousePos=[e.offsetX,e.offsetY];const t=j(),[a,r]=v(g.mousePos);if(!g.mouseStartPos)return;const[s,o]=v(g.mouseStartPos);switch(g.mouseStartPos=null,u.tool){case"pen":case"erasor":case"bucket":I();break;case"rect":case"circle":case"line":t.merge(u.fCanvas),u.fCanvas.clear(),I();break;case"move":if(t.scissorRect){const[e,n]=[a-s,r-o];t.merge(u.fCanvas,e,n),u.fCanvas.clear(),I()}}},keydown(t){if(!t.metaKey)for(const e in s){if(s[e].key===t.key)return void(u.tool=e)}const a=j();switch(t.key){case"-":b();break;case"=":k();break;case"0":P();break;case"ArrowLeft":E();break;case"ArrowRight":z();break;case" ":g.grabbin=!0,t.preventDefault();break;case"Escape":K(),u.gaming=!1,u.gameTimer=0,u.readOnly=e.readOnly,x()}if(!u.readOnly)switch(t.key){case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":{const e=parseInt(t.key,10)-1;u.palette[e]&&R(e);break}case"+":y();break;case"_":A();break;case"z":t.metaKey&&(t.preventDefault(),t.shiftKey?C():x());break;case"s":t.metaKey&&(t.preventDefault(),U("save"));break;case"l":t.metaKey&&(t.preventDefault(),U("load"));break;case"Backspace":a.scissorRect?(F(),a.scissorRect=null):g.delCb();break;case"Escape":a.scissorRect=null;break;case"Tab":t.preventDefault(),g.hideUI=!g.hideUI}},keyup(e){if(" "===e.key)g.grabbin=!1}};d.onselectstart=()=>!1;for(const T in M)d.addEventListener(T,M[T]);function j(){return u.frames[u.curFrame]}function J(){return{version:"1",width:u.width,height:u.height,palette:u.palette,anims:u.anims,frames:u.frames.map((e=>e.toDataURL()))}}function q(e){return u.width=e.width,u.height=e.height,u.palette=e.palette,u.anims=e.anims,P(),Promise.all(e.frames.map(((e,t)=>i(e).then((e=>{u.frames[t]=e}))))).then((()=>{u.frames.length=e.frames.length,u.curFrame>=u.frames.length&&D(u.frames.length-1)}))}function L(e,...t){const a=URL.createObjectURL(new Blob(...t)),r=document.createElement("a");r.href=a,r.download=e,r.click()}return u.state.stack=[{frames:S(),curFrame:u.curFrame}],e.data&&q(e.data),{frames:function(){return u.frames},curFrame:j,on:function(e,t){u.events[e]||(u.events[e]=[]),u.events[e].push(t)},setTool:function(e){if(!s[e])throw new Error(`no tool called ${e} bro`);u.tool=e},setColor:R,setPalette:function(e){u.palette=e},save:J,load:q,undo:x,redo:C,pushState:I,scaleUp:k,scaleDown:b,scaleFit:P,newFrame:y,delFrame:A,prevFrame:E,nextFrame:z,download:function(e){L(e,[JSON.stringify(J())])},downloadPNG:function(e){L(e,[j().toPNG()])},cleanUp:function(){for(const e in M)d.removeEventListener(e,M[e]);window.cancelAnimationFrame(g.loopID)}}}}}]);
//# sourceMappingURL=4837-620646e1a5642611.js.map